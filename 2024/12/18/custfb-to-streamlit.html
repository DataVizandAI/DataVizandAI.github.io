<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" href="/assets/main.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Data Visualization, Data Science and AI" /></head>
<body class="container" style="background-color:ghostwhite;"><header><!--</header> class="site-header" role="banner" style="background-color: white">-->
  <div class="wrapper mb-2"><a class="site-title" style="font-size: larger;" rel="author" href="https://datavizandai.github.io">Data Visualization, Data Science and AI</a>
    <a class="site-nav" rel="author" href="/about">About</a>
  </div>
</header><main class="container" aria-label="Content">
      <div >
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">AI for BI: Transform Customer Feedback into Actionable Insights with CrewAI and Streamlit</h1>
    <h3>Build an AI-powered app to analyze unstructured feedback, generate insightful reports, and create interactive visualizations</h3>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-12-18T00:00:00+01:00" itemprop="datePublished">Dec 18, 2024
      </time></p>
  </header>

  <!-- Google Analytics-->
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VDYY6RYRK1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());

      gtag('config', 'G-VDYY6RYRK1');
  </script>

  <div class="row">
    <div class="col-sm-9">
      <div class="post-content e-content" itemprop="articleBody">
        <p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/AIBI/chartblue.png?raw=true" alt="" /></p>

<p><em>Based on Image by <a href="https://pixabay.com/users/colibrie-15745216/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=9126721">Temel</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=9126721">Pixabay</a></em></p>

<p>New AI agent tools have made automating data analysis remarkably simple. When combined with a visualisation platform like Streamlit, it is a simple task to create a visually compelling business reporting app.</p>

<p>In this tutorial, we will focus on analysing customer feedback. This analysis and a good understanding of customer sentiment are essential to ensure products meet expectations and that quality concerns are addressed. Products perceived as poor quality simply won’t sell.</p>

<p>However, analysing customer feedback can involve processing a large volume of unstructured data—a task that can be daunting. This is where large language models excel, making it possible to extract meaningful insights from this data.</p>

<p>Our first step is to clarify the objective.</p>

<p>Imagine we have a list of customer feedback messages about products from an online retailer. Our goal is to generate an executive report that highlights top-performing products, identifies issues with underperforming ones, and includes compelling visualizations of customer sentiment.</p>

<p>We are going to use CrewAI to orchestrate a handful of AI agents that will structure the data, analyse it, create an insightful report and finally, build a Streamlit app to present the results.</p>

<p>It will look like the screenshot, below.</p>

<p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/Screenshot-fb-reporter-app.png?raw=true" alt="" /></p>

<p>First, we need to define precisely what we want to do.</p>

<p>I have a list of fictional customer feedback messages about products from an online retailer. The messages are in Markdown format. I want to generate an executive report that highlights products that perform well, identifies issues with those that perform badly and includes some interactive charts on customer sentiment. And I want all of this to be in an interactive web app.</p>

<p>So, let’s define the steps we need to take.</p>

<h3 id="defining-the-process">Defining the process</h3>

<p>Here is the list of steps:</p>

<ol>
  <li>
    <p>Convert the raw customer data and create a structured version - probably CSV. This should make further analysis easier and it is something I can use directly in the resulting app.</p>
  </li>
  <li>
    <p>Calculate the sentiment of each customer message and add this to the structured data.</p>
  </li>
  <li>
    <p>Write a report that summarises the data in a table and includes sections that identify the best-performing products, those with quality problems and general issues that need to be addressed. The report should be formatted as Markdown.</p>
  </li>
  <li>
    <p>Create a Streamlit app that displays the report in one column and some interactive charts that show customer satisfaction in a second column.</p>
  </li>
  <li>
    <p>Make the structured customer feedback data available as a table in the app.</p>
  </li>
</ol>

<p>As with my previous article, <a href="https://datavizandai.github.io/2024/11/16/AI4BI-2.html"><em>AI for BI: Building a Business Information Report with CrewAI and OpenAI</em></a>, I used CrewAI and OpenAI to build this software. The reasons are the same, it’s not because they are necessarily the best technical solutions for this problem but they are convenient, easy to use and they do the job.</p>

<p>I used a Jupyter Notebook to write the analysis code, so most of the code you see below can be written directly into a notebook cell in the order it is presented. (To create a standalone app, simply concatenate  the cells.)</p>

<p>The reporter program in Streamlit is separate and is created by the AI. You will find all of the code and data in my GitHub repo.</p>

<p>As we will use the OpenAI API, you need an API key which should be accessible as an environment variable. If it is not yet stored as an environment variable, you can run the following code block first to ensure it is.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Omit this if your API key is already set as an environment variable

import os
os.environ["OPENAI_API_KEY"] = "your api key"
</code></pre></div></div>

<p>OpenAI will charge you for using their LLM. However, running the code below should cost no more than a few cents (but you <strong>MUST</strong> keep an eye on your usage in the OpenAI dashboard — things go wrong sometimes! It is also a good idea to set a monthly limit on your spending.)). The CrewAI software that we use is open source and costs nothing.</p>

<p>Let’s get on with the coding.</p>

<h3 id="writing-the-code">Writing the code</h3>

<p>I’ve outlined the steps that we will go through, above. These can be grouped into three stages: convert the raw data to CSV, write a report and create a Streamlit app. We will define agents and tasks for each stage and save the results. So we’ll end up with three files, the structured data in a CSV file, the report in a Markdown file and the Streamlit app.</p>

<p>There are two advantages to saving the intermediate files. The first is that, if we wish, we can run each of the three stages independently of the others. If we want to tweak the report’s structure, for example, there is no need to re-create the CSV file, we can use one we prepared earlier. And if the Streamlit app needs work it can be done independently of the rest of the coding. The second advantage is that the resulting app can use these files.</p>

<p>This is how we shall proceed but, before we get to the main code, a bit of setting up is required.</p>

<p>We need to import stuff from CrewAI and set the LLM model. As I said before, CrewAI defaults to using the OpenAI API so, as long as we have an API key, all we need to do is set the model we want to use in the variable <code class="language-plaintext highlighter-rouge">llm</code>. I have also set the <em>temperature</em> to zero. This reduces the randomness for a more consistent response.</p>

<p>I’ve also set a flag, <code class="language-plaintext highlighter-rouge">DEBUG</code>. This is used to control the verbosity of the agent response. For debugging purposes, it’s a good idea to have a full response to see how the agents process requests. Set <code class="language-plaintext highlighter-rouge">DEBUG</code> to <code class="language-plaintext highlighter-rouge">True</code> for this.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">crewai</span> <span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Crew</span><span class="p">,</span> <span class="n">LLM</span>

<span class="n">llm</span> <span class="o">=</span> <span class="nc">LLM</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span>
<span class="p">)</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<p>The next part of the code defines some file names. The first is the raw customer data file. The next two files will store intermediate data for the Streamlit app and the last one is the app itself.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># files
</span>
<span class="n">fb_raw</span> <span class="o">=</span>    <span class="sh">"</span><span class="s">./data/clothes.md</span><span class="sh">"</span>

<span class="n">fb_csv</span> <span class="o">=</span>    <span class="sh">"</span><span class="s">./data/fb.csv</span><span class="sh">"</span>
<span class="n">report_md</span> <span class="o">=</span> <span class="sh">"</span><span class="s">./data/report.md</span><span class="sh">"</span>
<span class="n">st_app</span> <span class="o">=</span>    <span class="sh">"</span><span class="s">./data/report.py</span><span class="sh">"</span>
</code></pre></div></div>

<p>Now we import the CrewAI tools required to read and write files and assign them to variables.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">crewai_tools</span> <span class="kn">import</span> <span class="n">FileReadTool</span><span class="p">,</span> <span class="n">FileWriterTool</span>

<span class="n">file_read_tool</span> <span class="o">=</span> <span class="nc">FileReadTool</span><span class="p">()</span>
<span class="n">file_writer_tool</span> <span class="o">=</span> <span class="nc">FileWriterTool</span><span class="p">()</span>
</code></pre></div></div>

<p>That’s all the preamble code out of the way and we can start on the main program.</p>

<p>CrewAI apps have three essential components: agents, tasks and crews. An agent is the interface to the LLM; it has a particular purpose and can be provided with functions (tools) to help it. A task details something that needs to be done by an agent. Finally, a crew executes a list of tasks and agents and returns a result.</p>

<p>We will define three agents that map onto the stages outlined above. One to create and modify a CSV file, another to write a report in Markdown and a third to build the Streamlit app.</p>

<p>Each agent is provided with one or more tasks and these agent/task combinations will be managed by a <em>crew</em>.</p>

<h3 id="csv-agent">CSV agent</h3>

<p>The first agent’s task is to construct a data structure from the raw Markdown file of customer feedback, then calculate customer sentiment and add that to the data structure.</p>

<p>There is no strict distinction between the attributes of the agent and the task. The task has a <code class="language-plaintext highlighter-rouge">description</code> and the agent has three descriptive attributes <code class="language-plaintext highlighter-rouge">role</code>, <code class="language-plaintext highlighter-rouge">goal</code> and <code class="language-plaintext highlighter-rouge">backstory</code>.  Each contributes towards a meaningful prompt that will be generated by CrewAI but it is ultimately up to us how we use them.</p>

<p>My approach here is to be concise in the agent definition and leave a detailed description of what the agent has to do for the task.</p>

<p>Using this approach, I can use the same agent for more than one task, as we shall see.</p>

<p>Here’s my definition of the CSV agent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">csv_agent</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">Extract, process data and record data</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="sh">"""</span><span class="s">Extract data and organise as instructed. 
                The result MUST be valid CSV.</span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">backstory</span><span class="o">=</span><span class="sh">"""</span><span class="s">You are a data processing agent</span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">],</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>And here is the first task.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_CSV</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s"> 
                Analyse </span><span class="sh">'</span><span class="s">{input_file}</span><span class="sh">'</span><span class="s"> the data provided - it is in 
                Markdown format. 
                Your output should be in CSV format. Respond without 
                using Markdown code fences.

                The data is about the range of items in an online shop.
                Following this is a set of messages from customers giving 
                feedback about the products that they have purchased.

                Your task is to:
                   Create a structured file in CSV format that records a 
                   list of all customer feedback messages.
                   Each item in the list should have its columns 
                   populated as follows.

                        </span><span class="sh">"</span><span class="s">Product</span><span class="sh">"</span><span class="s">: insert the name of the item, 
                        </span><span class="sh">"</span><span class="s">Overall_Rating</span><span class="sh">"</span><span class="s">: insert the rating as given by customer, 
                        </span><span class="sh">"</span><span class="s">Issue</span><span class="sh">"</span><span class="s">: insert any issues identified - if no issue can be identified write </span><span class="sh">'</span><span class="s">None</span><span class="sh">'</span><span class="s">, 
                        </span><span class="sh">"</span><span class="s">Review</span><span class="sh">"</span><span class="s">: insert the customer message 
                </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"</span><span class="s">A correctly formatted CSV data structure</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">csv_agent</span><span class="p">,</span>   
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The task is much more explicit and tells the agent exactly what to do. The result should be a CSV structure with four columns.</p>

<p>We also want a fifth column that holds the sentiment of each message. So as not to overcomplicate the prompts, I assign this to a second task.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_sentiment</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s"> 
                Analyse CSV data and calculate the sentiment of each 
                message in the </span><span class="sh">'</span><span class="s">Review</span><span class="sh">'</span><span class="s"> column. Add a new column to the 
                CSV that records that sentiment.
                Your output should be in CSV format. Respond without 
                using Markdown code fences.              
                </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"</span><span class="s">A correctly formatted CSV data file</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">csv_agent</span><span class="p">,</span>   
    <span class="n">output_file</span><span class="o">=</span><span class="n">fb_csv</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Notice that in this task there is an extra attribute <code class="language-plaintext highlighter-rouge">output_file</code>which is set to the file name for the CSV file.  This tells the task to automatically place the result in that file.</p>

<p>Having defined the tasks, we execute them.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crew</span> <span class="o">=</span> <span class="nc">Crew</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">csv_agent</span><span class="p">,</span> <span class="n">csv_agent</span><span class="p">],</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">create_CSV</span><span class="p">,</span> <span class="n">add_sentiment</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="n">DEBUG</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result1</span> <span class="o">=</span> <span class="n">crew</span><span class="p">.</span><span class="nf">kickoff</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">input_file</span><span class="sh">'</span><span class="p">:</span> <span class="n">fb_raw</span><span class="p">})</span>
</code></pre></div></div>

<p>In the crew, there is a list of agents and tasks that will be executed sequentially and when the crew is run, the input file name is set as a parameter. Notice that we have two tasks that use the same agent.</p>

<p>Once complete we will have a CSV file with a structure something like this:</p>

<p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/AIBI/customer-feedback-df.png?raw=true" alt="" /></p>

<p>Our next job is to write a report.</p>

<h3 id="report-writing-agent">Report writing agent</h3>

<p>We now have some nicely formatted data that has been enhanced with a customer sentiment assessment and saved in a file for later use.</p>

<p>Our next job is to attempt a deeper analysis of the data with a new agent.</p>

<p>Once again, the agent definition is short and the detail of the work to be done is in the task.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define agent
</span><span class="n">report_generator</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">Compile and present results</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="sh">"""</span><span class="s">Deliver a polished, structured report on customer 
                satisfaction.
             </span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">backstory</span><span class="o">=</span><span class="sh">"""</span><span class="s">You are an agent, that generates clear, 
                     well-designed and professional reports</span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">],</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>The task defines precisely what the report should look like and what it should contain.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_report</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s">
            Read the CSV data in </span><span class="sh">'</span><span class="s">{csv_file}</span><span class="sh">'</span><span class="s">, create a summary report.
            The report must consolidate and summarize the customer 
            feedback, it should be in Markdown file format 
            (without ``` fences). 

            The report should be structured as follows:

                # Product review report

                ### Summary

                Insert a Markdown table with a row for every product.
                The table header should look like this:

                | Product | Average Rating | Number of reviews | Positive | Neutral | Negative |

                The should be a row for every product like this:

                | insert the product name here 
                | insert the average of all the rating for this product 
                | insert total number of reviews
                | insert number of positive reviews 
                | insert number of neutral reviews 
                | insert number of negative reviews |

                ### Insights

                #### Best performers

                insert a short report on the products with the best reviews

                #### Underperformers

                insert a short report on the products that are underperforming

                #### Issues

                insert a short report on what steps need to be taken to improve products and sales
    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"""</span><span class="s">A Markdown report file</span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">report_generator</span><span class="p">,</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">report_md</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>CrewAI does a good job of producing a report and the result is saved in <code class="language-plaintext highlighter-rouge">report_md</code>by executing the following crew.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crew</span> <span class="o">=</span> <span class="nc">Crew</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">report_generator</span><span class="p">],</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">create_report</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="n">DEBUG</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result2</span> <span class="o">=</span> <span class="n">crew</span><span class="p">.</span><span class="nf">kickoff</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">input_file</span><span class="sh">'</span><span class="p">:</span><span class="n">fb_raw</span><span class="p">,</span> <span class="sh">'</span><span class="s">csv_file</span><span class="sh">'</span><span class="p">:</span> <span class="n">fb_csv</span><span class="p">})</span>
</code></pre></div></div>

<p>You can see the full report in my GitHub repo but below is a screenshot of the report part of the app so you can see the sort of thing that is produced.</p>

<p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/AIBI/report_screen_shot.png?raw=true" alt="" /></p>

<p>Next, we want to generate the app.</p>

<h3 id="streamlit-app">Streamlit app</h3>

<p>I’ve tried to make the app as general as possible so that it will cope with different sets of feedback messages about different products.</p>

<p>Consequently, you only need to run this part of the code once. You’ll then have a Streamlit app that will read the CSV files and Markdown report that we generated earlier or, indeed, ones we create later.</p>

<p>I tackle the app generation in two parts using two tasks but with the same Streamlit generating agent.</p>

<p>Here is the agent definition.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define agent
</span><span class="n">app_generator</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">Create or modify a Streamlit program</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="sh">"""</span><span class="s">To deliver a valid, Streamlit program  in Python, with 
                meaningful variable and function names.
                Ensure that the output strictly conforms to Python syntax.
                Do not include ``` fencing.
           </span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">backstory</span><span class="o">=</span><span class="sh">"""</span><span class="s">You are an agent that generates clear, well-designed
                     Streamlit programs</span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_writer_tool</span><span class="p">,</span> <span class="n">file_read_tool</span><span class="p">],</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>Now for the first task. It sets up the basic app and loads the CSV data as a Pandas dataframe. I had to tell it about a (now fairly old) update to the Streamlit API. An earlier version used the decorator <code class="language-plaintext highlighter-rouge">st.cache</code>, this is deprecated and we should use <code class="language-plaintext highlighter-rouge">st.cache_data</code> to cache the CSV data instead. I was quite surprised at this as the new decorator has been around for a while now. However, the problem was easily solved as you can see.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_app</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s">
            Create a Streamlit app as follows:
            - set the display to wide format
            - include the pandas and ploty express libraries
            - create a pandas dataframe called </span><span class="sh">"</span><span class="s">df</span><span class="sh">"</span><span class="s"> from the csv file 
              {csv_file} include all fields
            Note that st.cache is deprecated, use st.cache_data instead.

            Don</span><span class="sh">'</span><span class="s">t save the program to a file.

    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"""</span><span class="s">A valid and syntactically correct Python program</span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">app_generator</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Now we have a basic program. In the next task, I give explicit instructions on how to add to this program to display the data and construct the charts.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_content</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s">
            Modify the Streamlit code as follows:
            - create two tabs, the first named </span><span class="sh">"</span><span class="s">report_tab</span><span class="sh">"</span><span class="s"> the second 
              named </span><span class="sh">"</span><span class="s">messages_tab</span><span class="sh">"</span><span class="s">
            - in </span><span class="sh">"</span><span class="s">messages_tab</span><span class="sh">"</span><span class="s"> load the dataframe, </span><span class="sh">"</span><span class="s">df</span><span class="sh">"</span><span class="s">, in a st.table 
            - in report_tab create two columns of equal width called 
              </span><span class="sh">"</span><span class="s">report_column</span><span class="sh">"</span><span class="s"> and </span><span class="sh">"</span><span class="s">chart_column</span><span class="sh">"</span><span class="s">
            - in the column </span><span class="sh">"</span><span class="s">report_column</span><span class="sh">"</span><span class="s"> read the report from 
              {report_file} and display it in st.markdown
            - in the </span><span class="sh">"</span><span class="s">chart_column</span><span class="sh">"</span><span class="s"> draw a bar chart of </span><span class="sh">'</span><span class="s">Product</span><span class="sh">'</span><span class="s"> over 
              </span><span class="sh">'</span><span class="s">Overall_Rating</span><span class="sh">'</span><span class="s">
            - in the column </span><span class="sh">"</span><span class="s">chart_column</span><span class="sh">"</span><span class="s"> draw a histogram of </span><span class="sh">'</span><span class="s">Sentiment</span><span class="sh">'</span><span class="s"> 
              with the bars colored by </span><span class="sh">'</span><span class="s">Product</span><span class="sh">'</span><span class="s">

    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"</span><span class="s">A valid and syntactically correct Python program</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">st_app</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">app_generator</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">]</span>   
<span class="p">)</span>         
</code></pre></div></div>

<p>As before, we run both tasks with a single agent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crew</span> <span class="o">=</span> <span class="nc">Crew</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">app_generator</span><span class="p">,</span> <span class="n">app_generator</span><span class="p">],</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">create_app</span><span class="p">,</span> <span class="n">add_content</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="n">DEBUG</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">result3</span> <span class="o">=</span> <span class="n">crew</span><span class="p">.</span><span class="nf">kickoff</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">csv_file</span><span class="sh">'</span><span class="p">:</span> <span class="n">fb_csv</span> <span class="p">,</span>
                               <span class="sh">'</span><span class="s">report_file</span><span class="sh">'</span><span class="p">:</span> <span class="n">report_md</span><span class="p">})</span>
</code></pre></div></div>

<p>That’s the final stage done. Run the Streamlit app; the result will be the screenshot we saw earlier. Note that with the way I have organised the folders you will need to run Streamlit from the parent folder thus:</p>

<p>` streamlit run data/report.py`</p>

<h3 id="final-thoughts-on-crewai">Final thoughts on CrewAI</h3>

<p>On the whole, I was quite happy with the result. CrewAI is an easy framework to get to grips with although it has a few foibles. There are a lot of descriptive strings that don’t feature in rival products and, while I’m sure that they make sense to the good folk at CrewAI, I’m not entirely convinced that they are all necessary.</p>

<p>However, having said that, I do like the way we can separate a task from an agent, giving the agent a broad description of its capabilities and providing the details of what needs to be done in the task. The other framework I’ve been looking at recently (<a href="https://datavizandai.github.io/2024/11/02/hands-on-swarm.html">Swarm</a>) doesn’t allow that.</p>

<p>I encountered a problem with CrewAI that I may have solved with this feature.</p>

<p>I was getting the following error when running one of the crews:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tool Output:

Error: the Action Input is not a valid key, value dictionary.
 Error parsing LLM output, agent will retry: I did it wrong. 
Invalid Format: I missed the <span class="s1">'Action:'</span> after <span class="s1">'Thought:'</span><span class="nb">.</span> 
I will <span class="k">do </span>right next, and don<span class="s1">'t use a tool I have already used.
</span></code></pre></div></div>

<p>Which is a little difficult to interpret.</p>

<p>This seemed something to do with the complexity of the task because when I split the tasks the problem disappeared.</p>

<p>However, I’m not entirely convinced that my complexity diagnosis was correct as I have been in touch with other developers who have found different solutions to what appears to be the same problem (lowering the temperature, for example - that didn’t work for me). At the time of writing, this is a live issue on the CrewAI GitHub repo.</p>

<p><strong><em>Update: that bug was intermittent and has happened again with the code, above You should keep an eye on the output when running this code. It could loop infinitely and if not stopped you might end up with a large bill.</em></strong></p>

<h3 id="final-thoughts-on-the-app">Final thoughts on the app</h3>

<p>I was very explicit in defining the Streamlit app. You could argue that I was so explicit that I might as well have written the app myself. It’s a simple program, so there is some merit in that.</p>

<p>But I wanted to produce an end-to-end program that produced the final product from the raw data. Perhaps, I could have been a little vaguer with the program definition. Perhaps, that would have resulted in a better program! But apart from the cache decorator problem, the AI produced no errors (and it types much quicker than me!) so I’m not complaining.</p>

<p>The final question is why Streamlit? While it is a perfectly good framework for this sort of app, the real answer is, because ChatGPT-4o mini has the programming knowledge to use it!</p>

<p>Asking ChatGPT to use a newer, or less well-known, framework such as Mesop or Taipy would have produced poorer results. The LLM ‘knows’ less about these products and is more likely to make mistakes and hallucinate.</p>

<hr />

<p>The code and data for this article can be found in this <a href="https://github.com/alanjones2/CrewAIapps">GitHub repo</a> in the <em>AI4BI-fb</em> folder. The resulting charts and report are in the same folder.</p>

<p>All illustrations are by me, the author, unless otherwise stated.</p>
<div style="padding:20px; border-style: solid;border-color: aqua;">
 
    Thanks for reading. If you liked this article please consider subscribing to my 
    <a href="technofile.substack.com" target="_blank">newsletter</a> and you'll be notified
    of new content.
    <br/>
    Most of my stuff is also on <a href="https://medium.com/@alan-jones" target="_blank">Medium</a> (paywalled).
    <br/>
    If the article was useful, please consider a contribution.

</div>
<div>
    <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
    <script>
        kofiWidgetOverlay.draw('alan_jones', {
            'type': 'floating-chat',
            'floating-chat.donateButton.text': 'Support me',
            'floating-chat.donateButton.background-color': '#5bc0de',
            'floating-chat.donateButton.text-color': '#323842'
        });
    </script>
</div></div>

    </div>
    <div class="col-sm-3">
      Sponsored content
    <!--ads etc here -->
    <!-- streamlit from scratch-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light"  
         style="background-image: url('https://github.com/alanjones2/streamlitfromscratch/blob/main/sfsimage.png?raw=true');background-size: cover;">
        <div>
            <i>eBook</i>
            <img class="mr-3" src="" width='80%' height='auto' alt="">
            <h2>
                <a href="https://alanjones2.github.io/streamlitfromscratch/" target="_blank">
                    <span  style="color:navy" >Streamlit from Scratch</span>
                </a>
            </h2>
            <p class="lead" style="color: navy;"><b>Streamlit</b> is a framework for creating Data Science apps in Python.
                <br />
                <b>Streamlit from Scratch</b> will take from building a simple we page through to creating fully functional interactive data dashboards.
            </p>

        </div>
    </div>
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">

        <i>eBook</i>
        <h2><a href='https://alanjones.gumroad.com/l/auiws' target='_blank'><span  style="color:navy" >Plotting with Pandas</span></a>
        </h2>
        <p class="lead" style="color: navy;">
            <b>Plotting with Pandas: an Introduction to Data Visualization</b> is an ebook that covers basic and
            statistical plots using Python and Pandas, line and bar charts, scatter plots, pie charts,
            histograms, box plots, etc.
        </p>



    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->


    <!-- how charts work-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/61y5lxsc9DL._SY466_.jpg" width='80%'
                height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/47FKuiz" target="_blank">
                    <span class="text-dark">How Charts Work: Understand and explain data with
                        confidence</span>
                </a>
            </h5>
            <h6>From the Back Cover</h6>
            <p>
                How Charts Work brings the secrets of effective data visualisation in a way that will
                help you bring data alive.
                Charts, graphs and tables are essential devices in business, but all too often they
                present information poorly.
                This
                book will help you:

                <li>Feel confident understanding different types of charts, graphs and tables – and how
                    to read them</li>
                <li>Recognise the true story behind the data presented and what the information really
                    shows</li>
                <li>Know the principles and rules of how best to represent information so you can create
                    your own
                    information-driven (and
                    beautiful) visuals</li>
                <li>Design visuals that people engage with, understand and act upon</li>
            </p>

        </div>
    </div>
    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <!-- the art of statistics-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/61eFjiH7sIL._SY264_BO1,204,203,200_QL40_ML2_.jpg"
                width='80%' height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/3kVBGmo" target="_blank">
                    <span class="text-dark">The Art of Statistics: How to Learn from Data</span>
                </a>
            </h5>
            Discover how data literacy is changing the world and gives you a better understanding of
            life's biggest problems. I have used this book in various articles and found it to be
            invaluable.

        </div>
    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    
    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <!-- storytelling in data-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/41OonY0kRWL._SX399_BO1,204,203,200_.jpg"
                width='80%' height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/3JmzEFq" target="_blank">
                    <span class="text-dark">Storytelling with Data: A Data Visualization Guide for
                        Business</span>
                </a>
            </h5>
            Don't simply show your data - tell a story with it! Storytelling with Data teaches you
            the fundamentals of data visualization and how to communicate effectively with data. I
            use this book in the series of articles '12 Essential Visualizations and How to
            Implement them.

        </div>
    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <!-- How charts lie -->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/41N21MzfCRL._SX329_BO1,204,203,200_.jpg"
                width='80%' height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/3ZuQO9B" target="_blank">
                    <span class="text-dark">How Charts Lie: Getting Smarter about Visual
                        Information</span>
                </a>
            </h5>
            A leading data visualization expert explores the negative - and positive - influences
            that charts have on our perception of truth. I used this book as the inspiration for
            'How Not to Lie with Charts'.

        </div>
    </div>


    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <div id="amzn-assoc-ad-d5bf4dcd-55c6-4038-a3d8-ff8bfa49de8a"></div>
    <script async
        src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=d5bf4dcd-55c6-4038-a3d8-ff8bfa49de8a"></script>

</div>



  </div><a class="u-url" href="/2024/12/18/custfb-to-streamlit.html" hidden></a>
</article>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

  </body>

</html>
