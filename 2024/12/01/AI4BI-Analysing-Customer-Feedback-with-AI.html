<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" href="/assets/main.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Data Visualization, Data Science and AI" /></head>
<body class="container" style="background-color:ghostwhite;"><header><!--</header> class="site-header" role="banner" style="background-color: white">-->
  <div class="wrapper mb-2"><a class="site-title" style="font-size: larger;" rel="author" href="https://datavizandai.github.io">Data Visualization, Data Science and AI</a>
    <a class="site-nav" rel="author" href="/about">About</a>
  </div>
</header><main class="container" aria-label="Content">
      <div >
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">AI for BI: Analysing Customer Feedback with AI</h1>
    <h3>Using synthetic data we analyse the customer feedback from the sales of shoes from a fictional online shoe shop.</h3>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-12-01T00:00:00+01:00" itemprop="datePublished">Dec 1, 2024
      </time></p>
  </header>

  <!-- Google Analytics-->
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VDYY6RYRK1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());

      gtag('config', 'G-VDYY6RYRK1');
  </script>

  <div class="row">
    <div class="col-sm-9">
      <div class="post-content e-content" itemprop="articleBody">
        <p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/AIBI/choong-deng-xiang--WXQm_NTK0U-unsplash.jpg?raw=true" alt="" /></p>

<p><em>Photo by <a href="https://unsplash.com/@dengxiangs?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Choong Deng Xiang</a> on <a href="https://unsplash.com/photos/graphical-user-interface--WXQm_NTK0U?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></em></p>

<p>Customer feedback is a critical resource for retailers who wish to ensure their products meet customer expectations and want to address potential quality issues. Analysing large amounts of unstructured feedback can be a challenge, but this, of course, is where large language models excel.</p>

<p>In this tutorial, we will demonstrate how to use an LLM, via AI agents, to transform customer feedback into actionable insights. To illustrate this, we will begin by generating data about an online store along with some synthetic customer feedback. This is easily achieved using ChatGPT.</p>

<p>Next, we will develop an application to analyse the data and produce a customer feedback report.</p>

<p>Much of the example code is in the form of a Jupyter Notebook but I have also written a simple Streamlit app that presents the results interactively. See the screenshot, below.</p>

<p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/Screenshot-fb-reporter-app.png?raw=true" alt="" /></p>

<h3 id="an-online-shop">An online shop</h3>

<p>Generating the synthetic data was a one-off task so I used ChatGPT from the web interface. I first told it I wanted to create data about an online shoe shop and then asked it to suggest a list of products.</p>

<p>ChatGPT decided on the name <strong><em>StepSavvy</em></strong> for the shop and produced descriptions of a range of shoes, e.g.</p>

<p>    <strong><em>CloudStrider Sneakers</em></strong> - <em>Lightweight, breathable running shoes.</em></p>

<p>    <strong><em>SwiftShine Heels</em></strong> - <em>Comfortable high heels with a glossy finish</em>.</p>

<p>Not very impressive names, perhaps, but fine for our purposes.</p>

<p>To make things realistic and to give my imaginary customers something to complain about, I needed to introduce some quality issues with some of the range. Rather than bother my brain with this, I asked ChatGPT to invent some problems with a few shoe types and it suggested, for example, that the sneakers had durability issues:</p>

<p>    <strong><em>Durability Issues</em></strong>: <em>Customers report the soles wearing out or detaching after only a few months of use.</em></p>

<p>We are nearly there now: we have a fictional shop, with a fictional range of shoes, and we have identified some quality issues with certain shoes in that range.</p>

<p>Now it was simply a matter of asking ChatGPT to create customer feedback messages for each shoe type, both those that were affected by the quality issues and those that were not. ChatGPT helpfully suggested that it should include some positive reviews of the shoes that had quality problems so as to make things more realistic.</p>

<p>Here is an example of the type of messages that ChatGPT came up with:</p>

<p><strong><em>PeakTrek Hikers</em></strong></p>

<ol>
  <li><em>Rating: 1/5</em><br />
<em>“These boots claim to be waterproof, but my feet were soaked after just walking through damp grass. Not worth it.”</em></li>
  <li><em>Rating: 2/5</em><br />
<em>“I slipped multiple times on rocky trails because the soles don’t grip well on wet surfaces. Not safe for serious hikes.”</em></li>
  <li><em>Rating: 4/5</em><br />
<em>“The boots are sturdy and provide decent ankle support, but I wish the padding was thicker for longer treks.”</em></li>
  <li><em>Rating: 5/5</em><br />
<em>“Used these for a weekend hike in the mountains, and they held up really well. No blisters, and they felt solid.”</em></li>
</ol>

<p>The output from ChatGPT is in Markdown format which I saved in a file.</p>

<h3 id="analysing-the-data">Analysing the data</h3>

<p>As with my previous article, <a href="https://datavizandai.github.io/2024/11/16/AI4BI-2.html"><em>AI for BI: Building a Business Information Report with CrewAI and OpenAI</em></a>, I used CrewAI and OpenAI[1] to build this software. The reasons are the same, it’s not because they are necessarily the best technical solutions for this problem but they are convenient, easy to use and they do the job.</p>

<p>As I mentioned, I used a Jupyter Notebook to write the analysis code, so most of the code you will see below can be written directly into a notebook cell in the order it is presented. The simple reporter program in Streamlit presents the results, plus a couple of charts, on a web page (you can also view the original customer messages). This is, of course, a separate program. You will find all of the code and data in my GitHub repo.</p>

<p>As we will use the OpenAI API,  your API key should be accessible as an environment variable. If it is not yet stored as an environment variable, you can run the following code block first to ensure it is.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
os.environ["OPENAI_API_KEY"] = "your api key"
</code></pre></div></div>

<p>First things first: we need to import stuff from CrewAI and set the LLM model. As I said before, CrewAI defaults to using the OpenAI API so, as long as we have an API key, all we need to do is set the model we want to use in the variable <code class="language-plaintext highlighter-rouge">llm</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">crewai</span> <span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Crew</span>
<span class="n">llm</span> <span class="o">=</span> <span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span>
</code></pre></div></div>

<p>The data is in a Markdown file so we must provide the agent with a tool to read it. We will also be writing data files, so we need a tool for that, too.</p>

<p>The following code imports the tools and set variables so we can access them.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">crewai_tools</span> <span class="kn">import</span> <span class="n">FileReadTool</span><span class="p">,</span> <span class="n">FileWriterTool</span>

<span class="n">file_read_tool</span> <span class="o">=</span> <span class="nc">FileReadTool</span><span class="p">()</span>
<span class="n">file_writer_tool</span> <span class="o">=</span> <span class="nc">FileWriterTool</span><span class="p">()</span>
</code></pre></div></div>

<p>We are going to define an agent to read the Markdown file and format it as JSON as this is more easily interpreted than plain text. We give the agent instructions on how to construct the JSON and we also get it to save the result as a local file.</p>

<p>I want to save this intermediate result as a file for a few reasons:</p>

<ul>
  <li>
    <p>while the agent can give us feedback as it works, it’s nice to have a permanent record of the result</p>
  </li>
  <li>
    <p>by recording the result outside of the agent context, we can separate this stage from the next one, - where we create the report - and not clog up the LLM context window with unnecessary messages (we’ll see this later)</p>
  </li>
  <li>
    <p>lastly, I’m going to use that file in the reporter app, later.</p>
  </li>
</ul>

<h3 id="feedback-analyser-agent">Feedback analyser agent</h3>

<p>The following is the code for the agent that will analyse the customer feedback.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fb_analyser_agent</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">Feedback analyser</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="sh">"""</span><span class="s">Read the file provided it is in Markdown format. 
                It contains data about the range of items in an online shoe shop.
                Following this is a set of messages from customers giving
                feedback about the shoes that they have purchased.
                You goal is to:
                1. Calculate the sentiment for every customer message
                2. Create a structured file in JSON format that records a
                   list of all customer feedback messages. 
                   Each item in the list should be structured as follows
                   (the items in curly brackets should be calculated or extracted from the data):

                    {</span><span class="sh">"</span><span class="s">Shoe</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{Name of item}</span><span class="sh">"</span><span class="s">, 
                     </span><span class="sh">"</span><span class="s">Overall Rating</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{rating as given by customer}</span><span class="sh">"</span><span class="s">, 
                     </span><span class="sh">"</span><span class="s">Issue</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{any issues identified - </span><span class="sh">'</span><span class="s">None</span><span class="sh">'</span><span class="s"> if none identified}</span><span class="sh">"</span><span class="s">, 
                     </span><span class="sh">"</span><span class="s">Review</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{customer message}</span><span class="sh">"</span><span class="s">, 
                     </span><span class="sh">"</span><span class="s">Sentiment</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">{calculated sentiment of customer message}</span><span class="sh">"</span><span class="s">}    

                3. Save the file using the name provided.
           </span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">backstory</span><span class="o">=</span><span class="sh">"</span><span class="s">Your aim is to read and analyse customer feedback for items sold online</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">,</span> <span class="n">file_writer_tool</span><span class="p">],</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>This is a straightforward CrewAI agent. We give it a <code class="language-plaintext highlighter-rouge">role</code>, a <code class="language-plaintext highlighter-rouge">goal</code> and a <code class="language-plaintext highlighter-rouge">backstory</code> - CrewAI uses these to create prompts that will instruct the LLM. The most important of these is the <code class="language-plaintext highlighter-rouge">goal</code>. It is here that we give explicit instructions to the LLM: we first tell it to read the file and then calculate the sentiment for each of the messages.</p>

<p>Next, we ask it to create a JSON file that contains the data and give it a template that defines the structure of the JSON file.</p>

<p>The structure of the JSON file was defined in the agent code above. It is a list of entries similar to the JSON code shown below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Example entry in JSON file
</span>    <span class="c1"># not to be included in the notebook
</span>    <span class="p">{</span>
        <span class="sh">"</span><span class="s">Shoe</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">CloudStrider Sneakers</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Overall Rating</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">2/5</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Issue</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Durability</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Review</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The shoes were super comfortable
                   initially, but after just two
                   months, the sole started to peel off!
                   Really disappointed with the durability.</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">Sentiment</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Negative</span><span class="sh">"</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Finally, we tell it to save the result.</p>

<p>In addition to the instructions, we need to provide the agent with a list of the tools available to it and specify the LLM that we are using.</p>

<p>Using a template is very useful when we want the agent to produce a result that is consistent over a number of runs. LLMs notoriously come up with slightly different (even if correct) answers and format results differently unless we are explicit in how we want them to answer.</p>

<p>We will see a similar technique used in the next agent.</p>

<h3 id="quality-analyser-agent">Quality analyser agent</h3>

<p>We now have a nicely formatted set of data that has been enhanced with the addition of a customer sentiment assessment. Our next job is to attempt a deeper analysis of the data.</p>

<p>The agent code below does this. It is in the same format as the previous one but, of course, the instructions are different.</p>

<p>Read through the <code class="language-plaintext highlighter-rouge">goal</code> and you will see that the instructions are fairly simple. Most of the work is done in the template which contains, not the data itself, but instructions to the agent on how to create that data.</p>

<p>After a couple of headers, we see a Markdown table with a column header defined in the first line. For (human) readability reasons, I’ve listed each of the column entries vertically rather than horizontally as is conventional. The agent won’t care about this and it is perfectly good Markdown syntax, anyway.</p>

<p>So for each row of the columns, it will fill in the <em>product name</em>, work out <em>the average of all the ratings for this product</em>, enter the <em>total number of reviews</em>, and so on.</p>

<p>After the table, there are a few more headers followed by instructions on what to insert after it. For these, the agent has to do some fairly sophisticated analysis extracting information about the best and worst performers and indicating what issues need to be addressed to improve sales performance.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quality_analyser_agent</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
        <span class="n">role</span><span class="o">=</span><span class="sh">"</span><span class="s">Quality analyser</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">goal</span><span class="o">=</span><span class="sh">"""</span><span class="s">Using the JSON structured customer feedback, write a report that consolidates 
                and summarizes the customer feedback.                 
                The report should be in Markdown format.
                Save the report in the file </span><span class="sh">'</span><span class="s">./report.md</span><span class="sh">'</span><span class="s">. 

                The report should be structured in the
                following way (text in curly brackets should be calculated
                or otherwise derived from the data; 
                text in square backets are instructions that you should follow):

                     # Product review report

                     ### Summary

                     [create a table with an entry for each product in the follow format]

                     | Product | Average Rating | Number of reviews | Positve | Neutral | Negative |
                     | {product name} 
                     | {the average of all the rating for this product} 
                     | {total number of reviews} 
                     | {number of positive reviews} 
                     | {number of neutral reviews} 
                     | {number of negative reviews} |

                     ### Insights

                     #### Best performers

                     {report on the products with the best reviews}

                     #### Underperformers

                     {report on the products that are underperforming}

                     #### Issues

                     {what steps need to be taken to improve sales}


           </span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">backstory</span><span class="o">=</span><span class="sh">"</span><span class="s">You aim is to read and analyse customer feedback for items sold online</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">,</span> <span class="n">file_writer_tool</span><span class="p">],</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>So, that’s the agents defined; one for converting the customer feedback text into a machine-readable format and the second that produces a report on the quality issues revealed by the customer feedback.</p>

<p>If you’ve read my previous articles on CrewAI, you will know that now we need to define <em>tasks</em>. Tasks are specific jobs that need to be done by the agents that we have defined. They incorporate specific information that will be sent to the agents and (again) declare the required tools.</p>

<p>You can see that the first task, <code class="language-plaintext highlighter-rouge">create_JSON</code>, uses <code class="language-plaintext highlighter-rouge">fb_analyser_agent</code> and specifies the files that the agent should use.</p>

<p>The second task, <code class="language-plaintext highlighter-rouge">create_report</code>, uses <code class="language-plaintext highlighter-rouge">quality_analyser_agent</code> and specifies the file to be analysed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create_JSON</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s">Analyse </span><span class="sh">"</span><span class="s">shoes range and reviews.md</span><span class="sh">"</span><span class="s"> and save it in </span><span class="sh">"</span><span class="s">./fb.json</span><span class="sh">"</span><span class="s">.</span><span class="sh">'</span><span class="s">
                    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"""</span><span class="s">A JSON file</span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">fb_analyser_agent</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">,</span> <span class="n">file_writer_tool</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">create_report</span> <span class="o">=</span> <span class="nc">Task</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"""</span><span class="s">Using the data in the file </span><span class="sh">'</span><span class="s">./fb.json</span><span class="sh">'</span><span class="s">, create a summary report forand save it in </span><span class="sh">"</span><span class="s">./report.md</span><span class="sh">"</span><span class="s">.</span><span class="sh">'</span><span class="s">
                    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">expected_output</span><span class="o">=</span><span class="sh">"""</span><span class="s">A Markdown file</span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">quality_analyser_agent</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">file_read_tool</span><span class="p">,</span> <span class="n">file_writer_tool</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>To run the tasks we need to define a <em>crew</em> and run that. The code below is simple and self-explanatory.</p>

<p>We run the crew using the method <code class="language-plaintext highlighter-rouge">crew.kickoff()</code>. This invokes the agent, gives it the task, and returns the result.</p>

<p>Here is a crew that creates the JSON file.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define the crew
</span><span class="n">crew</span> <span class="o">=</span> <span class="nc">Crew</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">fb_analyser_agent</span><span class="p">],</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">create_JSON</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">crew</span><span class="p">.</span><span class="nf">kickoff</span><span class="p">()</span>
</code></pre></div></div>

<p>We could assign the return value to a variable (e.g. <code class="language-plaintext highlighter-rouge">result = crew.kickoff()</code>) but the only result we are interested in is the JSON code and this is already stored in a file.</p>

<p>The second crew can be seen below and it creates the report. Again, we don’t need to record the result as the result we want is in a file.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">crew</span> <span class="o">=</span> <span class="nc">Crew</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">quality_analyser_agent</span><span class="p">],</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">create_report</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">crew</span><span class="p">.</span><span class="nf">kickoff</span><span class="p">()</span>
</code></pre></div></div>

<p>As you can see from the code above, a crew contains a list of tasks and a list of agents. So, we could run both tasks/agents in the same crew like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This code runs the two tasks sequentially. And could
# potentially replace the two crews above
</span>
<span class="n">crew</span> <span class="o">=</span> <span class="nc">Crew</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">fb_analyser_agent</span><span class="p">,</span> <span class="n">quality_analyser_agent</span><span class="p">],</span>
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">create_JSON</span><span class="p">,</span> <span class="n">create_report</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">crew</span><span class="p">.</span><span class="nf">kickoff</span><span class="p">()</span>
</code></pre></div></div>

<p>I have not done this because the two tasks are completely independent. Combining them would mean the output of the first task would be fed into the second.</p>

<p>However, this is unnecessary because the messages created by the first task are irrelevant to the second one, which already has all the required information in the input file and the associated prompts. By keeping the tasks separate, we avoid clogging up the LLM’s context window with the lengthy output of the first task.</p>

<p>This completes the AI part of this little project. The report is too long to incorporate here, so I’ll add it to an appendix at the end of the article. You will see that it has incorporated the table that was specified and addressed the issues that we asked of it, identifying quality problems and noting the best- and worst-performing products.</p>

<h3 id="the-streamlit-reporter-app">The Streamlit reporter app</h3>

<p>As a bonus, we’ll look at a very straightforward app that will display the report that we have generated here alongside a couple of interactive charts. The app will also display the raw customer feedback data as a table. You saw a screenshot of the app earlier.</p>

<p>The listing is below. As you can see I’ve separated the app into two sections. The first defines all the data:</p>

<ul>
  <li>set the variable <code class="language-plaintext highlighter-rouge">df</code> to be a Pandas dataframe of the customer feedback data</li>
  <li>create a histogram that shows the customer sentiment as Positive, Neutral and Negative and colour the bars according to the product name</li>
  <li>create a second histogram that shows a similar breakdown of the overall ratings (note because the ratings are strings, not numeric, we need to specify the correct order)</li>
  <li>read the report into the variable <code class="language-plaintext highlighter-rouge">report</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### Reporter.py ###
</span>
<span class="kn">import</span> <span class="n">streamlit</span> <span class="k">as</span> <span class="n">st</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">plotly.express</span> <span class="k">as</span> <span class="n">px</span>

<span class="c1">### Set the data to be displayed in the app ###
</span>
<span class="c1"># Read the raw customer feedback
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_json</span><span class="p">(</span><span class="sh">"</span><span class="s">fb.json</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Draw a histogram for customer sentiment 
</span><span class="n">fig_sentiment</span> <span class="o">=</span> <span class="n">px</span><span class="p">.</span><span class="nf">histogram</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">Sentiment</span><span class="sh">"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">Shoe</span><span class="sh">'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">Customer Sentiment</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Draw a histogram for Overall Rating
</span><span class="n">fig_rating</span> <span class="o">=</span> <span class="n">px</span><span class="p">.</span><span class="nf">histogram</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="sh">"</span><span class="s">Overall Rating</span><span class="sh">"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">Shoe</span><span class="sh">'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">Overall Rating</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># We need to re-order the x axes ticks
</span><span class="n">fig_rating</span><span class="p">.</span><span class="nf">update_xaxes</span><span class="p">(</span><span class="n">categoryorder</span><span class="o">=</span><span class="sh">'</span><span class="s">array</span><span class="sh">'</span><span class="p">,</span>
                 <span class="n">categoryarray</span><span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">1/5</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">2/5</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">3/5</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">4/5</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">5/5</span><span class="sh">'</span><span class="p">])</span>

<span class="c1"># Read the markdown formatted report
</span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">report.md</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">report_file</span><span class="p">:</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">report_file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
</code></pre></div></div>

<p>The second part is the user interface and this code should be added to the bottom of the previous listing.</p>

<p>After setting some headers, we set up two tabs. In the first tab, there are two columns: the left one contains the textual report and the other contains the charts.</p>

<p>The second tab displays the customer feedback messages in a Streamlit table.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### The app UI ###
</span>
<span class="n">st</span><span class="p">.</span><span class="nf">set_page_config</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="sh">"</span><span class="s">wide</span><span class="sh">"</span><span class="p">)</span>

<span class="n">st</span><span class="p">.</span><span class="nf">subheader</span><span class="p">(</span><span class="sh">"</span><span class="s">:blue[Customer feedback report]</span><span class="sh">"</span><span class="p">)</span>
<span class="n">st</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">Select the report or the actual customer messages from the tabs below</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Two tabs the first is the complete report and 
# the second a list of all the customer feedback messages
</span><span class="n">report_tab</span><span class="p">,</span> <span class="n">customer_feedback_tab</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="nf">tabs</span><span class="p">([</span><span class="sh">"</span><span class="s">Report</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Customer messages</span><span class="sh">"</span><span class="p">])</span>

<span class="k">with</span> <span class="n">report_tab</span><span class="p">:</span>
    <span class="c1"># Display the report in the left column and the figures in the right one
</span>    <span class="n">report_text_col</span><span class="p">,</span><span class="n">charts_col</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="nf">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">report_text_col</span><span class="p">:</span>      
        <span class="n">st</span><span class="p">.</span><span class="nf">markdown</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">charts_col</span><span class="p">:</span>
        <span class="n">st</span><span class="p">.</span><span class="nf">plotly_chart</span><span class="p">(</span><span class="n">fig_sentiment</span><span class="p">)</span>
        <span class="n">st</span><span class="p">.</span><span class="nf">plotly_chart</span><span class="p">(</span><span class="n">fig_rating</span><span class="p">)</span>
<span class="k">with</span> <span class="n">customer_feedback_tab</span><span class="p">:</span>
    <span class="c1"># Display the complete set of messages in a table
</span>    <span class="n">st</span><span class="p">.</span><span class="nf">table</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<p>We’ve seen a screenshot of the app showing the first tab, above. For completeness, below is an image of (some of) the customer feedback in the second tab.</p>

<p><img src="https://github.com/alanjones2/CrewAIapps/blob/main/images/AIBI/customer-feedback-table.png?raw=true" alt="" /></p>

<p>This app is run with Streamlit, as usual:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>streamlit run reporter.py 
</code></pre></div></div>

<h3 id="thats-it">That’s it!</h3>

<p>We have seen how we can easily analyse customer data and produce useful insights using AI agents. And we’ve seen how easy that is using an agent orchestration framework such as CrewAI.</p>

<p>The Streamlit app is hopefully a useful addition that shows how we can present the data.</p>

<p>I did not use AI to generate the charts as I assumed that they would be a standard feature of the report and we would not need to redefine them for every new report. (If you are interested in how this could be done using an AI agent, see the article <a href="https://datavizandai.github.io/2024/11/16/AI4BI-2.html">AI for BI: Building a Business Information Report with CrewAI and OpenAI</a> where I create an agent to design a chart directly from CSV data.)</p>

<p>This is a simple example and is by no means perfect. There are, for example, certain quality issues that the agent did not report on. We might consider adjusting the prompts to cover more of them; perhaps we could tell the agent to identify the top 5 or 10 issues or to give a more detailed report on each product.</p>

<p>The data is clearly simple and there is a limited amount of it -  hopefully, in a real-world scenario, we would have more than a handful of customer feedback messages. But our approach could be the same (but, of course, the run times and costs would be higher.)</p>

<p>So, while this is not a complete solution to a practical business problem, it is, I hope, a useful demonstration of how AI tools can help to produce this type of business intelligence.</p>

<hr />

<p>As ever, thanks for reading . You can see more articles on my <a href="alanjones2.github.io">website</a> and subscribe to my occasional newsletter <a href="technofile.substack.com">here</a>. Most of my stuff is also on <a href="https://medium.com/@alan-jones">Medium</a> (paywalled).</p>

<p>The code and data for this article can be found in this <a href="https://github.com/alanjones2/CrewAIapps">GitHub repo</a> in the <em>AIBI-fb</em> folder. The resulting charts and report are in the same folder.</p>

<h3 id="notes">Notes</h3>

<ol>
  <li>
    <p>If you run the code here you will need an OpenAI account and an API key. Using this means you will be charged. Running the code here should not cost you more than a few 10s on cents but you should always check your expenditure on the OpenAI dashboard.</p>
  </li>
  <li>
    <p>All images and screenshots are by me, the author, unless otherwise stated.</p>
  </li>
  <li>
    <p>Disclaimer: I have no commercial connection with any company mentioned in this article.</p>
  </li>
</ol>

<h3 id="appendix---the-report">Appendix - the report</h3>

<p><em>The full report generated by the agent follows. If you are viewing this on Medium, the layout will not be exact as Medium cannot represent the full range of Markdown syntax (e.g. tables and nested bullet points). On my website, it is exactly as generated.</em></p>

<h1 id="product-review-report">Product review report</h1>

<h3 id="summary">Summary</h3>

<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Average Rating</th>
      <th>Number of reviews</th>
      <th>Positive</th>
      <th>Neutral</th>
      <th>Negative</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CloudStrider Sneakers</td>
      <td>2.75</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>PeakTrek Hikers</td>
      <td>3.00</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>SwiftShine Heels</td>
      <td>2.50</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>LuxeLace Oxfords</td>
      <td>4.50</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>EcoStep Slip-Ons</td>
      <td>4.50</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>BounceMax Runners</td>
      <td>4.75</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

<h3 id="insights">Insights</h3>

<h4 id="best-performers">Best performers</h4>

<ul>
  <li><strong>BounceMax Runners</strong>: With an exceptional average rating of 4.75, these shoes received positive feedback across all reviews. Customers appreciated the cushioning and support during long-distance runs.</li>
  <li><strong>LuxeLace Oxfords &amp; EcoStep Slip-Ons</strong>: Both have an average rating of 4.50 with a strong number of positive reviews, indicating satisfaction particularly in comfort and style.</li>
</ul>

<h4 id="underperformers">Underperformers</h4>

<ul>
  <li><strong>SwiftShine Heels</strong>: This product has the lowest average rating at 2.50, primarily due to negative sentiment focused on comfort and durability.</li>
  <li><strong>CloudStrider Sneakers</strong>: Must improve on durability which seems to be a recurring issue in the feedback received.</li>
</ul>

<h4 id="issues">Issues</h4>

<ul>
  <li><strong>Action Steps</strong>:
    <ul>
      <li><strong>SwiftShine Heels</strong>: Needs a redesign focused on improving comfort to avoid customer dissatisfaction.</li>
      <li><strong>CloudStrider Sneakers</strong>: Address durability issues by using better quality materials.</li>
      <li><strong>PeakTrek Hikers</strong>: Improve waterproofing and grip features, as these were highlighted as concerns in reviews.</li>
    </ul>
  </li>
</ul>

      </div>
    </div>
    <div class="col-sm-3">
      Sponsored content
    <!--ads etc here -->
    <!-- streamlit from scratch-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light"  
         style="background-image: url('https://github.com/alanjones2/streamlitfromscratch/blob/main/sfsimage.png?raw=true');background-size: cover;">
        <div>
            <i>eBook</i>
            <img class="mr-3" src="" width='80%' height='auto' alt="">
            <h3>
                <a href="https://alanjones2.github.io/streamlitfromscratch/" target="_blank">
                    <span  style="color:navy" >Streamlit from Scratch</span>
                </a>
            </h3>
            <p><b>Streamlit</b> is a framework for creating Data Science apps in Python.
                <br />
                <b>Streamlit from Scratch</b> is an ebook that will teach you how to get started with
                Streamlit.
            </p>

        </div>
    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->


    <!-- how charts work-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/61y5lxsc9DL._SY466_.jpg" width='80%'
                height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/47FKuiz" target="_blank">
                    <span class="text-dark">How Charts Work: Understand and explain data with
                        confidence</span>
                </a>
            </h5>
            <h6>From the Back Cover</h6>
            <p>
                How Charts Work brings the secrets of effective data visualisation in a way that will
                help you bring data alive.
                Charts, graphs and tables are essential devices in business, but all too often they
                present information poorly.
                This
                book will help you:

                <li>Feel confident understanding different types of charts, graphs and tables – and how
                    to read them</li>
                <li>Recognise the true story behind the data presented and what the information really
                    shows</li>
                <li>Know the principles and rules of how best to represent information so you can create
                    your own
                    information-driven (and
                    beautiful) visuals</li>
                <li>Design visuals that people engage with, understand and act upon</li>
            </p>

        </div>
    </div>
    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <!-- the art of statistics-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/61eFjiH7sIL._SY264_BO1,204,203,200_QL40_ML2_.jpg"
                width='80%' height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/3kVBGmo" target="_blank">
                    <span class="text-dark">The Art of Statistics: How to Learn from Data</span>
                </a>
            </h5>
            Discover how data literacy is changing the world and gives you a better understanding of
            life's biggest problems. I have used this book in various articles and found it to be
            invaluable.

        </div>
    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">

        <i>eBook</i>
        <h5><a href='https://alanjones.gumroad.com/l/auiws' target='_blank'>Plotting with Pandas</a>
        </h5>
        <p>
            <b>Plotting with Pandas: an Introduction to Data Visualization</b> is an ebook that covers basic and
            statistical plots using Python and Pandas, line and bar charts, scatter plots, pie charts,
            histograms, box plots, etc.
        </p>



    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <!-- storytelling in data-->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/41OonY0kRWL._SX399_BO1,204,203,200_.jpg"
                width='80%' height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/3JmzEFq" target="_blank">
                    <span class="text-dark">Storytelling with Data: A Data Visualization Guide for
                        Business</span>
                </a>
            </h5>
            Don't simply show your data - tell a story with it! Storytelling with Data teaches you
            the fundamentals of data visualization and how to communicate effectively with data. I
            use this book in the series of articles '12 Essential Visualizations and How to
            Implement them.

        </div>
    </div>

    <!-- google add start-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <!-- google add end-->

    <!-- How charts lie -->
    <div class="p-4 shadow-sm mb-4 rounded border border-secondary bg-light">
        <div>
            <i>Sponsored content</i>
            <!--<img class="mr-3" src="https://m.media-amazon.com/images/I/41N21MzfCRL._SX329_BO1,204,203,200_.jpg"
                width='80%' height='auto' alt="">-->
            <h5 class="mt-0">
                <a href="https://amzn.to/3ZuQO9B" target="_blank">
                    <span class="text-dark">How Charts Lie: Getting Smarter about Visual
                        Information</span>
                </a>
            </h5>
            A leading data visualization expert explores the negative - and positive - influences
            that charts have on our perception of truth. I used this book as the inspiration for
            'How Not to Lie with Charts'.

        </div>
    </div>


    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>
    <!-- sfs vertical -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959" data-ad-slot="6617299104"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <div id="amzn-assoc-ad-d5bf4dcd-55c6-4038-a3d8-ff8bfa49de8a"></div>
    <script async
        src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=d5bf4dcd-55c6-4038-a3d8-ff8bfa49de8a"></script>

</div>

  </div><a class="u-url" href="/2024/12/01/AI4BI-Analysing-Customer-Feedback-with-AI.html" hidden></a>
</article>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

  </body>

</html>
